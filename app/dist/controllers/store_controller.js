angular.module("SistersCtrls").controller("StoreCtrl",["$scope","$state","$http","$timeout","$location","$sessionStorage","allProducts","ProductsService",function(t,e,o,a,s,n,r,i){var l=document.getElementById("main");l.style.backgroundColor="",t.loaded=!1,t.products=r,console.log("what are products? ",t.products),t.showProduct=function(t){e.go("storeShow",{id:t})},a(function(){t.loaded=!0,t.$emit("loadMainContainer","loaded")})}]).controller("StoreCartCtrl",["$scope","$state","$http","$timeout","$location","$sessionStorage",function(t,e,o,a,s,n){var r=document.getElementById("main");r.style.backgroundColor="",t.$emit("loadMainContainer","loaded"),t.toCheckout=function(){s.url("/store/checkout/address")},t.continue=function(){s.url("/store")}}]).controller("StoreShowCtrl",["$scope","$stateParams","$state","$http","$timeout","$location","$sessionStorage","oneProduct",function(t,e,o,a,s,n,r,i){var l=document.getElementById("main");l.style.backgroundColor="",t.$emit("loadMainContainer","loaded"),console.log("what is oneProduct? ",i),t.product=i,t.images=i.images;var c=t.images[0];t.skus=t.product.skus.data,console.log("skus: ",t.skus),t.data={},t.data.selected=t.product.skus.data[0],console.log("selected: ",t.data.selected);var d=document.querySelector(".main-product-photo img");d.src=t.images[0],t.isActiveImg=function(){return this.img===c},t.whatSelected=function(){console.log(t.data.selected)},t.changeActive=function(){c=this.img,d.src=this.img}}]).controller("CheckoutTemplateCtrl",["$scope","$state","$http","$timeout","$location","$localStorage",function(t,e,o,a,s,n){t.$emit("loadMainContainer","loaded"),t.$storage=n,t.$on("cartChange",function(e,o){console.log("CART CHANGE UPDATED!!!!!!!!!!!!! ",o),t.showPath=o}),console.log("what is showPath? ",t.showPath),t.showPath||(t.showPath=t.$storage.pathCount,console.log("showPath is now ",t.showPath))}]).controller("StoreAddressCtrl",["$scope","$state","$window","$timeout","$http","$location","$localStorage","ngCart","$rootScope","CurrentOrderService",function(t,e,o,a,s,n,r,i,l,c){var d=document.getElementById("main");d.style.backgroundColor="rgba(247, 237, 245, 0)",t.$emit("loadMainContainer","loaded"),t.$storage=r,console.log("what is shipping? ",i.getShipping()),console.log("show me items: ",i.getItems()),t.cartItems=i.getItems(),l.path=n.$$path,(!t.$storage.pathCount||t.$storage.pathCount<1)&&(t.$storage.pathCount=0,t.$emit("cartChange",t.$storage.pathCount)),t.loaded=[],console.log("what is rootScope? ",l),t.data={shipping:{country:{}},billing:{country:{}}},t.mailingListAdd=!0,t.shippingSameBool=!1,s.get("/js/JSON/countries.json").success(function(e){t.countries=e,console.log("what is first country? ",t.countries[0]),t.data.shipping.country=t.countries[0],t.data.billing.country=t.countries[0],t.loaded.push("go")}),s.get("/js/JSON/states.json").success(function(e){t.states=e,t.loaded.push("go")}),s.get("/js/JSON/provinces.json").success(function(e){t.provinces=e,t.loaded.push("go")}),t.isShippingSame=function(){t.data.shippingSame?(t.data.billing=t.data.shipping,t.shippingSameBool=!0):(t.data.billing={},t.shippingSameBool=!1)},t.countryChange=function(e){"US"===e.code?t.shippingType=t.shipRates.domestic:t.shippingType=t.shipRates.international},t.submitForm=function(e){if(e.$valid){t.loaded=[];var o=t.data.shipping;t.data.billing;t.$storage.billingAddress=t.data.billing;var a={url:"/stripe/createOrder",method:"POST",params:{order:{currency:"usd",items:t.cartItems,shipping:{name:o.name,address:{line1:o.address1,line2:o.address2||null,city:o.city,state:o.stateProvince.short||null,country:o.country.code,postal_code:o.postalCode}},email:o.email,metadata:{taxRate:i.getTaxRate()}}}};s(a).then(function(e){"created"===e.data.status?(console.log("SUCCESS! ",e),t.$storage.mailingList=t.mailingListAdd,t.$storage.addressSubmit||(t.$storage.pathCount++,t.$emit("cartChange",t.$storage.pathCount)),t.$storage.addressSubmit=!0,t.$storage.orderData=e,t.$evalAsync(function(){n.url("/store/checkout/payment")})):(t.loaded=[1,2,3],console.log("ERROR!!!! ",e.data),t.errorMessage=e.data.message)},function(t){console.log("error ",t)})}else console.log("form invalid!!")},t.getTaxRate=function(t,e,a){if("US"===t.code&&"WA"===e.short&&a)if(o.localStorage.currentWaRate){var n=parseFloat(o.localStorage.currentWaRate);i.setTaxRate(n)}else{console.log("in WA State!!!!!");var r={url:"/taxRate",method:"GET",params:{country:"usa",postal:a}};s(r).then(function(t){console.log("what is response? ",t.data),console.log("type of total rate ",typeof t.data.totalRate),i.setTaxRate(t.data.totalRate),o.localStorage.currentWaRate=t.data.totalRate},function(t){console.log("error ",t)})}else"US"===t.code&&"WA"!==e.short?(console.log("not in WA state"),i.setTaxRate(0)):"US"!==t.code&&(console.log("Outside US!!!!!!!"),i.setTaxRate(0))}}]).controller("StorePaymentCtrl",["$scope","$state","$http","$timeout","$location","$localStorage","ngCart","$rootScope","currentOrder",function(t,e,o,a,s,n,r,i,l){var c=document.getElementById("main");c.style.backgroundColor="rgba(247, 237, 245, 0)",t.$emit("loadMainContainer","loaded"),i.path=s.$$path,t.$storage=n,t.pathCount=parseInt(t.$storage.pathCount),t.shipOptions=t.$storage.orderData.data.shipping_methods,t.savedSelectedShip=t.$storage.orderData.data.selected_shipping_method;for(var d=0;d<t.shipOptions.length;d++)if(t.shipOptions[d].id===t.savedSelectedShip){t.selectedShip=t.shipOptions[d];break}t.$watch("selectedShip",function(e,o,a){console.log("what is shipChoice? ",t.selectedShip),r.setShipping(t.selectedShip.amount)},!1),a(function(){t.loaded=!0}),t.submitForm=function(e){t.loaded=!1,Stripe.card.createToken({number:t.number,cvc:t.cvc,exp:t.expiry,name:t.$storage.billingAddress.name,address_line1:t.$storage.billingAddress.address1,address_line2:t.$storage.billingAddress.address2||null,address_city:t.$storage.billingAddress.city,address_state:t.$storage.billingAddress.stateProvince.short||null,address_zip:t.$storage.billingAddress.postalCode,address_country:t.$storage.billingAddress.country.code},g)};var g=function(e,a){if(a.error);else{token=a;var n={url:"/stripe/updateShipping",method:"POST",params:{token:token,orderId:t.$storage.orderData.data.id,selectedShip:t.selectedShip.id}};o(n).then(function(e){console.log("Success! ",e),t.$storage.paymentSubmit||(t.$storage.pathCount++,t.$emit("cartChange",t.$storage.pathCount)),t.$storage.paymentSubmit=!0,t.$storage.orderData=e,t.$storage.tokenData=token,s.url("/store/checkout/confirm")},function(e){t.loaded=!0,console.log("error ",e)})}}}]).controller("StoreConfirmCtrl",["$scope","$state","$http","$timeout","$location","$localStorage","ngCart","$rootScope",function(t,e,o,a,s,n,r,i){var l=document.getElementById("main");l.style.backgroundColor="rgba(247, 237, 245, 0)",t.$emit("loadMainContainer","loaded"),t.$storage=n,t.pathCount=parseInt(t.$storage.pathCount),t.orderComplete=!1,i.path=s.$$path,console.log("what is rootScope? ",i),t.ngCart=r,t.token=t.$storage.tokenData,t.order=t.$storage.orderData.data;for(var c=t.order.items,d=0;d<c.length;d++)"shipping"===c[d].type&&(t.shipService=c[d].description);a(function(){t.loaded=!0}),t.createCharge=function(){t.loaded=!1;var e={url:"/stripe/orderComplete",method:"POST",params:{orderId:t.order.id,token:t.token.id}};o(e).then(function(e){console.log("Success! ",e),t.orderComplete=!0,t.$storage.mailingList&&g(),r.setTaxRate(),r.setShipping(),r.empty(),n.$reset()},function(e){t.loaded=!0,console.log("error ",e)})};var g=function(){console.log("submit clicked!");var e="//sisterstheband.us14.list-manage.com/subscribe/post-json?u=bc38720b0bcc7a32641bb572c&amp;id=242f4adc89&EMAIL="+t.$storage.orderData.data.email+"&c=JSON_CALLBACK";o.jsonp(e).then(function(t){console.log("success!!! ",t)},function(t){console.log(t)})}}]);