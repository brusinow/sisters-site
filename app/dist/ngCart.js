"use strict";angular.module("ngCart",["ngCart.directives"]).config([function(){}]).provider("$ngCart",function(){this.$get=function(){}}).run(["$rootScope","ngCart","ngCartItem","store",function($rootScope,ngCart,ngCartItem,store){$rootScope.$on("ngCart:change",function(){ngCart.$save()}),angular.isObject(store.get("cart"))?ngCart.$restore(store.get("cart")):ngCart.init()}]).service("ngCart",["$rootScope","$location","$window","ngCartItem","store",function($rootScope,$location,$window,ngCartItem,store){this.init=function(){this.$cart={shipping:null,taxRate:null,tax:null,items:[]}},this.addItem=function(id,sku,name,price,quantity,data,attr){var inCart=this.getItemById(id);if("object"==typeof inCart)inCart.setQuantity(quantity,!1),$rootScope.$broadcast("ngCart:itemUpdated",inCart);else{var newItem=new ngCartItem(id,sku,name,price,quantity,data,attr);this.$cart.items.push(newItem),$rootScope.$broadcast("ngCart:itemAdded",newItem)}$rootScope.$broadcast("ngCart:change",{})},this.addItemBtn=function(id,sku,name,price,quantity,data){var skus=data.skus;if(1===skus.length){var inCart=this.getItemById(id);if("object"==typeof inCart)inCart.setQuantity(quantity,!1),$rootScope.$broadcast("ngCart:itemUpdated",inCart);else{var newItem=new ngCartItem(id,sku,name,price,quantity,data);this.$cart.items.push(newItem),$rootScope.$broadcast("ngCart:itemAdded",newItem)}$rootScope.$broadcast("ngCart:change",{})}else $location.url("/store/"+data.id)},this.changeQuantity=function(id,quantity){var inCart=this.getItemById(id);"object"==typeof inCart?(inCart.setQuantity(quantity,!0),$rootScope.$broadcast("ngCart:itemUpdated",inCart)):console.log("nothing there"),$rootScope.$broadcast("ngCart:change",{})},this.getItemById=function(itemId){var items=this.getCart().items,build=!1;return angular.forEach(items,function(item){item.getId()===itemId&&(build=item)}),build},this.setShipping=function(shipping){return this.$cart.shipping=shipping,$rootScope.$broadcast("ngCart:change",{}),this.getShipping()},this.getShipping=function(){return 0==this.getCart().items.length?0:this.getCart().shipping},this.setTaxRate=function(taxRate){return this.$cart.taxRate=+parseFloat(taxRate).toFixed(2),$rootScope.$broadcast("ngCart:change",{}),this.getTaxRate()},this.getTaxRate=function(){return this.$cart.taxRate},this.getTax=function(){return Math.round(this.getSubTotal()/100*this.getCart().taxRate)},this.setCart=function(cart){return this.$cart=cart,this.getCart()},this.getCart=function(){return this.$cart},this.getItems=function(){return this.getCart().items},this.getTotalItems=function(){var count=0,items=this.getItems();return angular.forEach(items,function(item){count+=item.getQuantity()}),count},this.getTotalUniqueItems=function(){return this.getCart().items.length},this.getSubTotal=function(){var total=0;return angular.forEach(this.getCart().items,function(item){total+=item.getTotal()}),+parseFloat(total).toFixed(2)},this.totalCost=function(){return+parseFloat(this.getSubTotal()+this.getShipping()+this.getTax()).toFixed(2)},this.removeItem=function(index){var item=this.$cart.items.splice(index,1)[0]||{};$rootScope.$broadcast("ngCart:itemRemoved",item),$rootScope.$broadcast("ngCart:change",{})},this.removeItemById=function(id){var item,cart=this.getCart();angular.forEach(cart.items,function(item,index){item.getId()===id&&(item=cart.items.splice(index,1)[0]||{})}),this.setCart(cart),$rootScope.$broadcast("ngCart:itemRemoved",item),$rootScope.$broadcast("ngCart:change",{})},this.empty=function(){$rootScope.$broadcast("ngCart:change",{}),this.$cart.items=[],$window.localStorage.removeItem("cart")},this.isEmpty=function(){return!(this.$cart.items.length>0)},this.toObject=function(){if(0===this.getItems().length)return!1;var items=[];return angular.forEach(this.getItems(),function(item){items.push(item.toObject())}),{shipping:this.getShipping(),tax:this.getTax(),taxRate:this.getTaxRate(),subTotal:this.getSubTotal(),totalCost:this.totalCost(),items:items}},this.$restore=function(storedCart){var _self=this;_self.init(),_self.$cart.shipping=storedCart.shipping,_self.$cart.taxRate=storedCart.taxRate,_self.$cart.tax=storedCart.tax,angular.forEach(storedCart.items,function(item){_self.$cart.items.push(new ngCartItem(item.parent,item.sku,item.description,item.amount,item.quantity,item._data,item.attr))}),this.$save()},this.$save=function(){return store.set("cart",JSON.stringify(this.getCart()))}}]).factory("ngCartItem",["$rootScope","$log",function($rootScope,$log){var item=function(id,sku,name,price,quantity,data,attr){this.setId(id),this.setSku(sku),this.setName(name),this.setPrice(price),this.setQuantity(quantity),this.setData(data),this.setAttr(attr)};return item.prototype.setId=function(id){id?this.parent=id:$log.error("An ID must be provided")},item.prototype.setSku=function(sku){sku?this.sku=sku:$log.error("A sku must be provided")},item.prototype.getId=function(){return this.parent},item.prototype.getSku=function(){return this.sku},item.prototype.setName=function(name){name?this.description=name:$log.error("A name must be provided")},item.prototype.getName=function(){return this.description},item.prototype.setPrice=function(price){var priceFloat=parseFloat(price);priceFloat?priceFloat<=0?$log.error("A price must be over 0"):this.amount=priceFloat:$log.error("A price must be provided")},item.prototype.getPrice=function(){return this.amount},item.prototype.setQuantity=function(quantity,relative){var quantityInt=parseInt(quantity);quantityInt%1===0?(relative===!0?this.quantity+=quantityInt:this.quantity=quantityInt,this.quantity<1&&(this.quantity=1)):(this.quantity=1,$log.info("Quantity must be an integer and was defaulted to 1"))},item.prototype.getQuantity=function(){return this.quantity},item.prototype.setData=function(data){data&&(this._data=data)},item.prototype.getData=function(){return this._data?this._data:void $log.info("This item has no data")},item.prototype.setAttr=function(attributes){attributes&&(this.attr=attributes)},item.prototype.getAttr=function(){if(this.attr){if(this.attr.size)return this.attr.size;if(this.attr.color)return this.attr.size}},item.prototype.getTotal=function(){return+parseFloat(this.getQuantity()*this.getPrice()).toFixed(2)},item.prototype.toObject=function(){return{id:this.getId(),name:this.getName(),price:this.getPrice(),quantity:this.getQuantity(),data:this.getData(),total:this.getTotal()}},item}]).service("store",["$window",function($window){return{get:function(key){if($window.localStorage.getItem(key)){var cart=angular.fromJson($window.localStorage.getItem(key));return JSON.parse(cart)}return!1},set:function(key,val){return void 0===val?$window.localStorage.removeItem(key):$window.localStorage.setItem(key,angular.toJson(val)),$window.localStorage.getItem(key)}}}]).controller("CartController",["$scope","$rootScope","ngCart","$timeout",function($scope,$rootScope,ngCart,$timeout){$scope.loaded=!1,$scope.toggleCart=!1,$scope.ngCart=ngCart,$timeout(function(){$scope.loaded=!0});var items=ngCart.getItems(),filtered=[];angular.forEach(items,function(item){"shippable"===item._data.product_type&&filtered.push(item)}),filtered.length>0?($scope.shipBool=!0,$scope.$emit("setShippable",!0)):($scope.shipBool=!1,$scope.$emit("setShippable",!1))}]).controller("CartBtnController",["$scope","ngCart","$timeout",function($scope,ngCart,$timeout){$scope.loaded=!1,$scope.toggleCart=!1,$scope.ngCart=ngCart,$timeout(function(){$scope.loaded=!0})}]).value("version","1.0.0"),angular.module("ngCart.directives",["ngCart.fulfilment"]).controller("CartController",["$scope","ngCart",function($scope,ngCart){$scope.ngCart=ngCart}]).directive("ngcartAddBtn",["ngCart",function(ngCart){return{restrict:"E",controller:"CartBtnController",scope:{id:"@",sku:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",data:"="},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/addtocartBtn.html":attrs.templateUrl},link:function(scope,element,attrs){scope.attrs=attrs,scope.inCart=function(){return ngCart.getItemById(attrs.id)},scope.inCart()?scope.q=ngCart.getItemById(attrs.id).getQuantity():scope.q=parseInt(scope.quantity),scope.qtyOpt=[];for(var i=1;i<=scope.quantityMax;i++)scope.qtyOpt.push(i)}}}]).directive("ngcartAddtocart",["ngCart",function(ngCart){return{restrict:"E",controller:"CartController",scope:{id:"@",sku:"@",name:"@",quantity:"@",quantityMax:"@",price:"@",data:"="},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/addtocart.html":attrs.templateUrl},link:function(scope,element,attrs){scope.attrs=attrs,scope.inCart=function(){return ngCart.getItemById(attrs.id)},scope.inCart()?scope.q=ngCart.getItemById(attrs.id).getQuantity():scope.q=parseInt(scope.quantity),scope.qtyOpt=[];var thisMax,showCountRef=firebase.database().ref("tickets/"+scope.id+"/totalTickets");showCountRef.once("value").then(function(snapshot){if(scope.totalTix=snapshot.val(),thisMax=scope.quantityMax<scope.totalTix?scope.quantityMax:scope.totalTix,thisMax>0)for(var i=1;i<=thisMax;i++)scope.qtyOpt.push(i)})}}}]).directive("ngcartCart",[function(){return{restrict:"E",controller:"CartController",scope:{},templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/cart.html":attrs.templateUrl},link:function(scope,element,attrs){}}}]).directive("ngcartSummary",[function(){return{restrict:"E",controller:"CartController",scope:{},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/summary.html":attrs.templateUrl}}}]).directive("ngcartCartConfirm",[function(){return{restrict:"E",controller:"CartController",scope:{},templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/cart-confirm.html":attrs.templateUrl},link:function(scope,element,attrs){}}}]).directive("ngcartSmallCart",[function(){return{restrict:"E",controller:"CartController",scope:{},templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/small-cart.html":attrs.templateUrl},link:function(scope,element,attrs){}}}]).directive("ngcartSmallCartCollapse",[function(){return{restrict:"E",controller:"CartController",scope:{},templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"views/ngCart/small-cart-collapse.html":attrs.templateUrl},link:function(scope,element,attrs){}}}]).directive("ngcartCheckout",[function(){return{restrict:"E",controller:["$rootScope","$scope","ngCart","fulfilmentProvider",function($rootScope,$scope,ngCart,fulfilmentProvider){$scope.ngCart=ngCart,$scope.checkout=function(){fulfilmentProvider.setService($scope.service),fulfilmentProvider.setSettings($scope.settings),fulfilmentProvider.checkout().success(function(data,status,headers,config){$rootScope.$broadcast("ngCart:checkout_succeeded",data)}).error(function(data,status,headers,config){$rootScope.$broadcast("ngCart:checkout_failed",{statusCode:status,error:data})})}}],scope:{service:"@",settings:"="},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"template/ngCart/checkout.html":attrs.templateUrl}}}]),angular.module("ngCart.fulfilment",[]).service("fulfilmentProvider",["$injector",function($injector){this._obj={service:void 0,settings:void 0},this.setService=function(service){this._obj.service=service},this.setSettings=function(settings){this._obj.settings=settings},this.checkout=function(){var provider=$injector.get("ngCart.fulfilment."+this._obj.service);return provider.checkout(this._obj.settings)}}]).service("ngCart.fulfilment.log",["$q","$log","ngCart",function($q,$log,ngCart){this.checkout=function(){var deferred=$q.defer();return $log.info(ngCart.toObject()),deferred.resolve({cart:ngCart.toObject()}),deferred.promise}}]).service("ngCart.fulfilment.http",["$http","ngCart",function($http,ngCart){this.checkout=function(settings){return $http.post(settings.url,{data:ngCart.toObject(),options:settings.options})}}]).service("ngCart.fulfilment.paypal",["$http","ngCart",function($http,ngCart){}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nQ2FydC5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwicHJvdmlkZXIiLCJ0aGlzIiwiJGdldCIsInJ1biIsIiRyb290U2NvcGUiLCJuZ0NhcnQiLCJuZ0NhcnRJdGVtIiwic3RvcmUiLCIkb24iLCIkc2F2ZSIsImlzT2JqZWN0IiwiZ2V0IiwiJHJlc3RvcmUiLCJpbml0Iiwic2VydmljZSIsIiRsb2NhdGlvbiIsIiR3aW5kb3ciLCIkY2FydCIsInNoaXBwaW5nIiwidGF4UmF0ZSIsInRheCIsIml0ZW1zIiwiYWRkSXRlbSIsImlkIiwic2t1IiwibmFtZSIsInByaWNlIiwicXVhbnRpdHkiLCJkYXRhIiwiYXR0ciIsImluQ2FydCIsImdldEl0ZW1CeUlkIiwic2V0UXVhbnRpdHkiLCIkYnJvYWRjYXN0IiwibmV3SXRlbSIsInB1c2giLCJhZGRJdGVtQnRuIiwic2t1cyIsImxlbmd0aCIsInVybCIsImNoYW5nZVF1YW50aXR5IiwiY29uc29sZSIsImxvZyIsIml0ZW1JZCIsImdldENhcnQiLCJidWlsZCIsImZvckVhY2giLCJpdGVtIiwiZ2V0SWQiLCJzZXRTaGlwcGluZyIsImdldFNoaXBwaW5nIiwic2V0VGF4UmF0ZSIsInBhcnNlRmxvYXQiLCJ0b0ZpeGVkIiwiZ2V0VGF4UmF0ZSIsImdldFRheCIsIk1hdGgiLCJyb3VuZCIsImdldFN1YlRvdGFsIiwic2V0Q2FydCIsImNhcnQiLCJnZXRJdGVtcyIsImdldFRvdGFsSXRlbXMiLCJjb3VudCIsImdldFF1YW50aXR5IiwiZ2V0VG90YWxVbmlxdWVJdGVtcyIsInRvdGFsIiwiZ2V0VG90YWwiLCJ0b3RhbENvc3QiLCJyZW1vdmVJdGVtIiwiaW5kZXgiLCJzcGxpY2UiLCJyZW1vdmVJdGVtQnlJZCIsImVtcHR5IiwibG9jYWxTdG9yYWdlIiwiaXNFbXB0eSIsInRvT2JqZWN0Iiwic3ViVG90YWwiLCJzdG9yZWRDYXJ0IiwiX3NlbGYiLCJwYXJlbnQiLCJkZXNjcmlwdGlvbiIsImFtb3VudCIsIl9kYXRhIiwic2V0IiwiSlNPTiIsInN0cmluZ2lmeSIsImZhY3RvcnkiLCIkbG9nIiwic2V0SWQiLCJzZXRTa3UiLCJzZXROYW1lIiwic2V0UHJpY2UiLCJzZXREYXRhIiwic2V0QXR0ciIsInByb3RvdHlwZSIsImVycm9yIiwiZ2V0U2t1IiwiZ2V0TmFtZSIsInByaWNlRmxvYXQiLCJnZXRQcmljZSIsInJlbGF0aXZlIiwicXVhbnRpdHlJbnQiLCJwYXJzZUludCIsImluZm8iLCJnZXREYXRhIiwiYXR0cmlidXRlcyIsImdldEF0dHIiLCJrZXkiLCJnZXRJdGVtIiwiZnJvbUpzb24iLCJwYXJzZSIsInZhbCIsInVuZGVmaW5lZCIsInNldEl0ZW0iLCJ0b0pzb24iLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHRpbWVvdXQiLCJsb2FkZWQiLCJ0b2dnbGVDYXJ0IiwiZmlsdGVyZWQiLCJwcm9kdWN0X3R5cGUiLCJzaGlwQm9vbCIsIiRlbWl0IiwidmFsdWUiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInNjb3BlIiwicXVhbnRpdHlNYXgiLCJ0cmFuc2NsdWRlIiwidGVtcGxhdGVVcmwiLCJlbGVtZW50IiwiYXR0cnMiLCJsaW5rIiwicSIsInF0eU9wdCIsImkiLCJ0aGlzTWF4Iiwic2hvd0NvdW50UmVmIiwiZmlyZWJhc2UiLCJkYXRhYmFzZSIsInJlZiIsIm9uY2UiLCJ0aGVuIiwic25hcHNob3QiLCJ0b3RhbFRpeCIsImZ1bGZpbG1lbnRQcm92aWRlciIsImNoZWNrb3V0Iiwic2V0U2VydmljZSIsInNldFNldHRpbmdzIiwic2V0dGluZ3MiLCJzdWNjZXNzIiwic3RhdHVzIiwiaGVhZGVycyIsInN0YXR1c0NvZGUiLCIkaW5qZWN0b3IiLCJfb2JqIiwiJHEiLCJkZWZlcnJlZCIsImRlZmVyIiwicmVzb2x2ZSIsInByb21pc2UiLCIkaHR0cCIsInBvc3QiLCJvcHRpb25zIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUdBQSxTQUFRQyxPQUFPLFVBQVcsc0JBRXJCQyxRQUFRLGVBSVJDLFNB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RSxNQUFLZ0IsS0FBS25HLE9BQU91RSxZQUNqQm1GLFNBQVNFLFNBQ0xyRyxLQUFLdkQsT0FBT3VFLGFBR1RtRixTQUFTRyxZQU0zQnBKLFFBQVEsMEJBQTJCLFFBQVMsU0FBVSxTQUFTcUosTUFBTzlKLFFBRS9ESixLQUFLbUosU0FBVyxTQUFTRyxVQUNyQixNQUFPWSxPQUFNQyxLQUFLYixTQUFTaEgsS0FDckJYLEtBQU12QixPQUFPdUUsV0FBWXlGLFFBQVNkLFNBQVNjLGNBSzVEdkosUUFBUSw0QkFBNkIsUUFBUyxTQUFVLFNBQVNxSixNQUFPOUoiLCJmaWxlIjoibmdDYXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCduZ0NhcnQnLCBbJ25nQ2FydC5kaXJlY3RpdmVzJ10pXHJcblxyXG4gICAgLmNvbmZpZyhbZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIH1dKVxyXG5cclxuICAgIC5wcm92aWRlcignJG5nQ2FydCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfTtcclxuICAgIH0pXHJcblxyXG4gICAgLnJ1bihbJyRyb290U2NvcGUnLCAnbmdDYXJ0JywnbmdDYXJ0SXRlbScsICdzdG9yZScsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCBuZ0NhcnQsIG5nQ2FydEl0ZW0sIHN0b3JlKSB7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCduZ0NhcnQ6Y2hhbmdlJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgbmdDYXJ0LiRzYXZlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChhbmd1bGFyLmlzT2JqZWN0KHN0b3JlLmdldCgnY2FydCcpKSkge1xyXG4gICAgICAgICAgICBuZ0NhcnQuJHJlc3RvcmUoc3RvcmUuZ2V0KCdjYXJ0JykpO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZ0NhcnQuaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XSlcclxuXHJcbiAgICAuc2VydmljZSgnbmdDYXJ0JywgWyckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckd2luZG93JywgJ25nQ2FydEl0ZW0nLCAnc3RvcmUnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkd2luZG93LCBuZ0NhcnRJdGVtLCBzdG9yZSkge1xyXG5cclxuICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB0aGlzLiRjYXJ0ID0ge1xyXG4gICAgICAgICAgICAgICAgc2hpcHBpbmcgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgdGF4UmF0ZSA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB0YXggOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgaXRlbXMgOiBbXVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuYWRkSXRlbSA9IGZ1bmN0aW9uIChpZCwgc2t1LCBuYW1lLCBwcmljZSwgcXVhbnRpdHksIGRhdGEsIGF0dHIpIHtcclxuICAgICAgICAgICAgdmFyIGluQ2FydCA9IHRoaXMuZ2V0SXRlbUJ5SWQoaWQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbkNhcnQgPT09ICdvYmplY3QnKXtcclxuICAgICAgICAgICAgICAgIC8vVXBkYXRlIHF1YW50aXR5IG9mIGFuIGl0ZW0gaWYgaXQncyBhbHJlYWR5IGluIHRoZSBjYXJ0XHJcbiAgICAgICAgICAgICAgICBpbkNhcnQuc2V0UXVhbnRpdHkocXVhbnRpdHksIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmdDYXJ0Oml0ZW1VcGRhdGVkJywgaW5DYXJ0KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdJdGVtID0gbmV3IG5nQ2FydEl0ZW0oaWQsIHNrdSwgbmFtZSwgcHJpY2UsIHF1YW50aXR5LCBkYXRhLCBhdHRyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuJGNhcnQuaXRlbXMucHVzaChuZXdJdGVtKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmdDYXJ0Oml0ZW1BZGRlZCcsIG5ld0l0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25nQ2FydDpjaGFuZ2UnLCB7fSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRJdGVtQnRuID0gZnVuY3Rpb24gKGlkLCBza3UsIG5hbWUsIHByaWNlLCBxdWFudGl0eSwgZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgc2t1cyA9IGRhdGEuc2t1cztcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoc2t1cy5sZW5ndGggPT09IDEpe1xyXG4gICAgICAgICAgICB2YXIgaW5DYXJ0ID0gdGhpcy5nZXRJdGVtQnlJZChpZCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGluQ2FydCA9PT0gJ29iamVjdCcpe1xyXG4gICAgICAgICAgICAgICAgLy9VcGRhdGUgcXVhbnRpdHkgb2YgYW4gaXRlbSBpZiBpdCdzIGFscmVhZHkgaW4gdGhlIGNhcnRcclxuICAgICAgICAgICAgICAgIGluQ2FydC5zZXRRdWFudGl0eShxdWFudGl0eSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduZ0NhcnQ6aXRlbVVwZGF0ZWQnLCBpbkNhcnQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIG5ld0l0ZW0gPSBuZXcgbmdDYXJ0SXRlbShpZCwgc2t1LCBuYW1lLCBwcmljZSwgcXVhbnRpdHksIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kY2FydC5pdGVtcy5wdXNoKG5ld0l0ZW0pO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduZ0NhcnQ6aXRlbUFkZGVkJywgbmV3SXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmdDYXJ0OmNoYW5nZScsIHt9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi51cmwoJy9zdG9yZS8nKyBkYXRhLmlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB0aGlzLmNoYW5nZVF1YW50aXR5ID0gZnVuY3Rpb24gKGlkLCBxdWFudGl0eSl7XHJcbiAgICAgICAgICAgIHZhciBpbkNhcnQgPSB0aGlzLmdldEl0ZW1CeUlkKGlkKTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbkNhcnQgPT09ICdvYmplY3QnKXtcclxuICAgICAgICAgICAgaW5DYXJ0LnNldFF1YW50aXR5KHF1YW50aXR5LCB0cnVlKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduZ0NhcnQ6aXRlbVVwZGF0ZWQnLCBpbkNhcnQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJub3RoaW5nIHRoZXJlXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmdDYXJ0OmNoYW5nZScsIHt9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLmdldEl0ZW1CeUlkID0gZnVuY3Rpb24gKGl0ZW1JZCkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLmdldENhcnQoKS5pdGVtcztcclxuICAgICAgICAgICAgdmFyIGJ1aWxkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAgKGl0ZW0uZ2V0SWQoKSA9PT0gaXRlbUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVpbGQgPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGJ1aWxkO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuc2V0U2hpcHBpbmcgPSBmdW5jdGlvbihzaGlwcGluZyl7XHJcbiAgICAgICAgICAgIHRoaXMuJGNhcnQuc2hpcHBpbmcgPSBzaGlwcGluZztcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduZ0NhcnQ6Y2hhbmdlJywge30pO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGlwcGluZygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0U2hpcHBpbmcgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRDYXJ0KCkuaXRlbXMubGVuZ3RoID09IDApIHJldHVybiAwO1xyXG4gICAgICAgICAgICByZXR1cm4gIHRoaXMuZ2V0Q2FydCgpLnNoaXBwaW5nO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuc2V0VGF4UmF0ZSA9IGZ1bmN0aW9uKHRheFJhdGUpe1xyXG4gICAgICAgICAgICB0aGlzLiRjYXJ0LnRheFJhdGUgPSArcGFyc2VGbG9hdCh0YXhSYXRlKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25nQ2FydDpjaGFuZ2UnLCB7fSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRheFJhdGUoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFRheFJhdGUgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kY2FydC50YXhSYXRlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRUYXggPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCgoKHRoaXMuZ2V0U3ViVG90YWwoKS8xMDApICogdGhpcy5nZXRDYXJ0KCkudGF4UmF0ZSApKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnNldENhcnQgPSBmdW5jdGlvbiAoY2FydCkge1xyXG4gICAgICAgICAgICB0aGlzLiRjYXJ0ID0gY2FydDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2FydCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0Q2FydCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRjYXJ0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0SXRlbXMgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDYXJ0KCkuaXRlbXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRUb3RhbEl0ZW1zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgY291bnQgPSAwO1xyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLmdldEl0ZW1zKCk7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGNvdW50ICs9IGl0ZW0uZ2V0UXVhbnRpdHkoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdldFRvdGFsVW5pcXVlSXRlbXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldENhcnQoKS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRTdWJUb3RhbCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciB0b3RhbCA9IDA7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGlzLmdldENhcnQoKS5pdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsICs9IGl0ZW0uZ2V0VG90YWwoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiArcGFyc2VGbG9hdCh0b3RhbCkudG9GaXhlZCgyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnRvdGFsQ29zdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICtwYXJzZUZsb2F0KHRoaXMuZ2V0U3ViVG90YWwoKSArIHRoaXMuZ2V0U2hpcHBpbmcoKSArIHRoaXMuZ2V0VGF4KCkpLnRvRml4ZWQoMik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy4kY2FydC5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpWzBdIHx8IHt9O1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25nQ2FydDppdGVtUmVtb3ZlZCcsIGl0ZW0pO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25nQ2FydDpjaGFuZ2UnLCB7fSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMucmVtb3ZlSXRlbUJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW07XHJcbiAgICAgICAgICAgIHZhciBjYXJ0ID0gdGhpcy5nZXRDYXJ0KCk7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChjYXJ0Lml0ZW1zLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGlmKGl0ZW0uZ2V0SWQoKSA9PT0gaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtID0gY2FydC5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpWzBdIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5zZXRDYXJ0KGNhcnQpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25nQ2FydDppdGVtUmVtb3ZlZCcsIGl0ZW0pO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25nQ2FydDpjaGFuZ2UnLCB7fSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5lbXB0eSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmdDYXJ0OmNoYW5nZScsIHt9KTtcclxuICAgICAgICAgICAgdGhpcy4kY2FydC5pdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjYXJ0Jyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmlzRW1wdHkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gKHRoaXMuJGNhcnQuaXRlbXMubGVuZ3RoID4gMCA/IGZhbHNlIDogdHJ1ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMudG9PYmplY3QgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdldEl0ZW1zKCkubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHRoaXMuZ2V0SXRlbXMoKSwgZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoIChpdGVtLnRvT2JqZWN0KCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBzaGlwcGluZzogdGhpcy5nZXRTaGlwcGluZygpLFxyXG4gICAgICAgICAgICAgICAgdGF4OiB0aGlzLmdldFRheCgpLFxyXG4gICAgICAgICAgICAgICAgdGF4UmF0ZTogdGhpcy5nZXRUYXhSYXRlKCksXHJcbiAgICAgICAgICAgICAgICBzdWJUb3RhbDogdGhpcy5nZXRTdWJUb3RhbCgpLFxyXG4gICAgICAgICAgICAgICAgdG90YWxDb3N0OiB0aGlzLnRvdGFsQ29zdCgpLFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6aXRlbXNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB0aGlzLiRyZXN0b3JlID0gZnVuY3Rpb24oc3RvcmVkQ2FydCl7XHJcbiAgICAgICAgICAgIHZhciBfc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIF9zZWxmLmluaXQoKTtcclxuICAgICAgICAgICAgX3NlbGYuJGNhcnQuc2hpcHBpbmcgPSBzdG9yZWRDYXJ0LnNoaXBwaW5nO1xyXG4gICAgICAgICAgICBfc2VsZi4kY2FydC50YXhSYXRlID0gc3RvcmVkQ2FydC50YXhSYXRlO1xyXG4gICAgICAgICAgICBfc2VsZi4kY2FydC50YXggPSBzdG9yZWRDYXJ0LnRheDtcclxuXHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzdG9yZWRDYXJ0Lml0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgX3NlbGYuJGNhcnQuaXRlbXMucHVzaChuZXcgbmdDYXJ0SXRlbShpdGVtLnBhcmVudCwgaXRlbS5za3UsIGl0ZW0uZGVzY3JpcHRpb24sIGl0ZW0uYW1vdW50LCBpdGVtLnF1YW50aXR5LCBpdGVtLl9kYXRhLCBpdGVtLmF0dHIpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuJHNhdmUoKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgIHRoaXMuJHNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5zZXQoJ2NhcnQnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmdldENhcnQoKSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XSlcclxuXHJcbiAgICAuZmFjdG9yeSgnbmdDYXJ0SXRlbScsIFsnJHJvb3RTY29wZScsICckbG9nJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRsb2cpIHtcclxuXHJcbiAgICAgICAgdmFyIGl0ZW0gPSBmdW5jdGlvbiAoaWQsIHNrdSwgbmFtZSwgcHJpY2UsIHF1YW50aXR5LCBkYXRhLCBhdHRyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SWQoaWQpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFNrdShza3UpO1xyXG4gICAgICAgICAgICB0aGlzLnNldE5hbWUobmFtZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJpY2UocHJpY2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFF1YW50aXR5KHF1YW50aXR5KTtcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnNldEF0dHIoYXR0cik7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGl0ZW0ucHJvdG90eXBlLnNldElkID0gZnVuY3Rpb24oaWQpe1xyXG4gICAgICAgICAgICBpZiAoaWQpICB0aGlzLnBhcmVudCA9IGlkO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0FuIElEIG11c3QgYmUgcHJvdmlkZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGl0ZW0ucHJvdG90eXBlLnNldFNrdSA9IGZ1bmN0aW9uKHNrdSl7XHJcbiAgICAgICAgICAgIGlmIChza3UpICB0aGlzLnNrdSA9IHNrdTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdBIHNrdSBtdXN0IGJlIHByb3ZpZGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5nZXRTa3UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5za3U7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGl0ZW0ucHJvdG90eXBlLnNldE5hbWUgPSBmdW5jdGlvbihuYW1lKXtcclxuICAgICAgICAgICAgaWYgKG5hbWUpICB0aGlzLmRlc2NyaXB0aW9uID0gbmFtZTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdBIG5hbWUgbXVzdCBiZSBwcm92aWRlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5nZXROYW1lID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb247XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaXRlbS5wcm90b3R5cGUuc2V0UHJpY2UgPSBmdW5jdGlvbihwcmljZSl7XHJcbiAgICAgICAgICAgIHZhciBwcmljZUZsb2F0ID0gcGFyc2VGbG9hdChwcmljZSk7XHJcbiAgICAgICAgICAgIGlmIChwcmljZUZsb2F0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJpY2VGbG9hdCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5lcnJvcignQSBwcmljZSBtdXN0IGJlIG92ZXIgMCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFtb3VudCA9IChwcmljZUZsb2F0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0EgcHJpY2UgbXVzdCBiZSBwcm92aWRlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5nZXRQcmljZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFtb3VudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgIFxyXG4gICAgICAgIGl0ZW0ucHJvdG90eXBlLnNldFF1YW50aXR5ID0gZnVuY3Rpb24ocXVhbnRpdHksIHJlbGF0aXZlKXtcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgcXVhbnRpdHlJbnQgPSBwYXJzZUludChxdWFudGl0eSk7XHJcbiAgICAgICAgICAgIGlmIChxdWFudGl0eUludCAlIDEgPT09IDApe1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlID09PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1YW50aXR5ICArPSBxdWFudGl0eUludDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWFudGl0eSA9IHF1YW50aXR5SW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucXVhbnRpdHkgPCAxKSB0aGlzLnF1YW50aXR5ID0gMTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnF1YW50aXR5ID0gMTtcclxuICAgICAgICAgICAgICAgICRsb2cuaW5mbygnUXVhbnRpdHkgbXVzdCBiZSBhbiBpbnRlZ2VyIGFuZCB3YXMgZGVmYXVsdGVkIHRvIDEnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaXRlbS5wcm90b3R5cGUuZ2V0UXVhbnRpdHkgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5xdWFudGl0eTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB0aGlzLl9kYXRhID0gZGF0YTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5nZXREYXRhID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2RhdGEpIHJldHVybiB0aGlzLl9kYXRhO1xyXG4gICAgICAgICAgICBlbHNlICRsb2cuaW5mbygnVGhpcyBpdGVtIGhhcyBubyBkYXRhJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaXRlbS5wcm90b3R5cGUuc2V0QXR0ciA9IGZ1bmN0aW9uKGF0dHJpYnV0ZXMpe1xyXG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlcykgdGhpcy5hdHRyID0gYXR0cmlidXRlcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdGVtLnByb3RvdHlwZS5nZXRBdHRyID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYXR0cil7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyW1wic2l6ZVwiXSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXR0cltcInNpemVcIl1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdHRyW1wiY29sb3JcIl0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hdHRyW1wic2l6ZVwiXVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgZWxzZSB7fTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG5cclxuXHJcblxyXG4gICAgICAgIGl0ZW0ucHJvdG90eXBlLmdldFRvdGFsID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuICtwYXJzZUZsb2F0KHRoaXMuZ2V0UXVhbnRpdHkoKSAqIHRoaXMuZ2V0UHJpY2UoKSkudG9GaXhlZCgyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpdGVtLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuZ2V0SWQoKSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuZ2V0TmFtZSgpLFxyXG4gICAgICAgICAgICAgICAgcHJpY2U6IHRoaXMuZ2V0UHJpY2UoKSxcclxuICAgICAgICAgICAgICAgIHF1YW50aXR5OiB0aGlzLmdldFF1YW50aXR5KCksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLmdldERhdGEoKSxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiB0aGlzLmdldFRvdGFsKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBpdGVtO1xyXG5cclxuICAgIH1dKVxyXG5cclxuICAgIC5zZXJ2aWNlKCdzdG9yZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcblxyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmICggJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpICkgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FydCA9IGFuZ3VsYXIuZnJvbUpzb24oICR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSApIDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShjYXJ0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG5cclxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oIGtleSwgYW5ndWxhci50b0pzb24odmFsKSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1dKVxyXG5cclxuICAgIC5jb250cm9sbGVyKCdDYXJ0Q29udHJvbGxlcicsWyckc2NvcGUnLCckcm9vdFNjb3BlJywgJ25nQ2FydCcsJyR0aW1lb3V0JywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCBuZ0NhcnQsICR0aW1lb3V0KSB7XHJcbiAgICAgICAgJHNjb3BlLmxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS50b2dnbGVDYXJ0ID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLm5nQ2FydCA9IG5nQ2FydDtcclxuICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkc2NvcGUubG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAgIHZhciBpdGVtcyA9IG5nQ2FydC5nZXRJdGVtcygpO1xyXG4gICAgICAgICAgICAvLyBsb29wIHRvIGRldGVybWluZSBpZiBhbnkgaXRlbXMgYXJlIHNoaXBwYWJsZVxyXG4gIFxyXG4gICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSBbXTtcclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5fZGF0YS5wcm9kdWN0X3R5cGUgPT09IFwic2hpcHBhYmxlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGZpbHRlcmVkLmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNoaXBCb29sID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnc2V0U2hpcHBhYmxlJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hpcEJvb2wgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnc2V0U2hpcHBhYmxlJywgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgIH1dKVxyXG5cclxuICAgIC5jb250cm9sbGVyKCdDYXJ0QnRuQ29udHJvbGxlcicsWyckc2NvcGUnLCAnbmdDYXJ0JywnJHRpbWVvdXQnLCBmdW5jdGlvbigkc2NvcGUsIG5nQ2FydCwgJHRpbWVvdXQpIHtcclxuICAgICAgICBcclxuICAgICAgICAkc2NvcGUubG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLnRvZ2dsZUNhcnQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUubmdDYXJ0ID0gbmdDYXJ0O1xyXG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICRzY29wZS5sb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfV0pXHJcblxyXG4gICAgLnZhbHVlKCd2ZXJzaW9uJywgJzEuMC4wJyk7XHJcbjsndXNlIHN0cmljdCc7XHJcblxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ25nQ2FydC5kaXJlY3RpdmVzJywgWyduZ0NhcnQuZnVsZmlsbWVudCddKVxyXG5cclxuICAgIC5jb250cm9sbGVyKCdDYXJ0Q29udHJvbGxlcicsWyckc2NvcGUnLCAnbmdDYXJ0JywgZnVuY3Rpb24oJHNjb3BlLCBuZ0NhcnQpIHtcclxuICAgICAgICBcclxuICAgICAgICAkc2NvcGUubmdDYXJ0ID0gbmdDYXJ0O1xyXG5cclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgIH1dKVxyXG5cclxuICAgICAgICAgIC5kaXJlY3RpdmUoJ25nY2FydEFkZEJ0bicsIFsnbmdDYXJ0JywgZnVuY3Rpb24obmdDYXJ0KXtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdCA6ICdFJyxcclxuICAgICAgICAgICAgY29udHJvbGxlciA6ICdDYXJ0QnRuQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBpZDonQCcsXHJcbiAgICAgICAgICAgICAgICBza3U6ICdAJyxcclxuICAgICAgICAgICAgICAgIG5hbWU6J0AnLFxyXG4gICAgICAgICAgICAgICAgcXVhbnRpdHk6J0AnLFxyXG4gICAgICAgICAgICAgICAgcXVhbnRpdHlNYXg6J0AnLFxyXG4gICAgICAgICAgICAgICAgcHJpY2U6J0AnLFxyXG4gICAgICAgICAgICAgICAgZGF0YTonPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBhdHRycy50ZW1wbGF0ZVVybCA9PSAndW5kZWZpbmVkJyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3ZpZXdzL25nQ2FydC9hZGR0b2NhcnRCdG4uaHRtbCc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhdHRycy50ZW1wbGF0ZVVybDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazpmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuYXR0cnMgPSBhdHRycztcclxuICAgICAgICAgICAgICAgIHNjb3BlLmluQ2FydCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICBuZ0NhcnQuZ2V0SXRlbUJ5SWQoYXR0cnMuaWQpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaW5DYXJ0KCkpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnEgPSBuZ0NhcnQuZ2V0SXRlbUJ5SWQoYXR0cnMuaWQpLmdldFF1YW50aXR5KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnEgPSBwYXJzZUludChzY29wZS5xdWFudGl0eSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUucXR5T3B0ID0gIFtdO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gc2NvcGUucXVhbnRpdHlNYXg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnF0eU9wdC5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcblxyXG4gICAgLmRpcmVjdGl2ZSgnbmdjYXJ0QWRkdG9jYXJ0JywgWyduZ0NhcnQnLCBmdW5jdGlvbihuZ0NhcnQpe1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0IDogJ0UnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyIDogJ0NhcnRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGlkOidAJyxcclxuICAgICAgICAgICAgICAgIHNrdTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbmFtZTonQCcsXHJcbiAgICAgICAgICAgICAgICBxdWFudGl0eTonQCcsXHJcbiAgICAgICAgICAgICAgICBxdWFudGl0eU1heDonQCcsXHJcbiAgICAgICAgICAgICAgICBwcmljZTonQCcsXHJcbiAgICAgICAgICAgICAgICBkYXRhOic9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGF0dHJzLnRlbXBsYXRlVXJsID09ICd1bmRlZmluZWQnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndmlld3MvbmdDYXJ0L2FkZHRvY2FydC5odG1sJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnRlbXBsYXRlVXJsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5hdHRycyA9IGF0dHJzO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaW5DYXJ0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIG5nQ2FydC5nZXRJdGVtQnlJZChhdHRycy5pZCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pbkNhcnQoKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucSA9IG5nQ2FydC5nZXRJdGVtQnlJZChhdHRycy5pZCkuZ2V0UXVhbnRpdHkoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucSA9IHBhcnNlSW50KHNjb3BlLnF1YW50aXR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5xdHlPcHQgPSAgW107XHJcbiAgICAgICAgICAgICAgICB2YXIgdGhpc01heDtcclxuICAgICAgICAgICAgICAgIHZhciBzaG93Q291bnRSZWYgPSBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigndGlja2V0cy8nKyBzY29wZS5pZCArICcvdG90YWxUaWNrZXRzJyk7XHJcbiAgICAgICAgICAgICAgICBzaG93Q291bnRSZWYub25jZSgndmFsdWUnKS50aGVuKGZ1bmN0aW9uKHNuYXBzaG90KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudG90YWxUaXggPSBzbmFwc2hvdC52YWwoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucXVhbnRpdHlNYXggPCBzY29wZS50b3RhbFRpeCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc01heCA9IHNjb3BlLnF1YW50aXR5TWF4O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc01heCA9IHNjb3BlLnRvdGFsVGl4O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpc01heCA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSB0aGlzTWF4OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucXR5T3B0LnB1c2goaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcblxyXG5cclxuXHJcbiAgICAuZGlyZWN0aXZlKCduZ2NhcnRDYXJ0JywgW2Z1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgOiAnQ2FydENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXR0cnMudGVtcGxhdGVVcmwgPT0gJ3VuZGVmaW5lZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd2aWV3cy9uZ0NhcnQvY2FydC5odG1sJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnRlbXBsYXRlVXJsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG5cclxuICAgIC5kaXJlY3RpdmUoJ25nY2FydFN1bW1hcnknLCBbZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdCA6ICdFJyxcclxuICAgICAgICAgICAgY29udHJvbGxlciA6ICdDYXJ0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7fSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBhdHRycy50ZW1wbGF0ZVVybCA9PSAndW5kZWZpbmVkJyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3ZpZXdzL25nQ2FydC9zdW1tYXJ5Lmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0cnMudGVtcGxhdGVVcmw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcblxyXG4gICAgIC5kaXJlY3RpdmUoJ25nY2FydENhcnRDb25maXJtJywgW2Z1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgOiAnQ2FydENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXR0cnMudGVtcGxhdGVVcmwgPT0gJ3VuZGVmaW5lZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd2aWV3cy9uZ0NhcnQvY2FydC1jb25maXJtLmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0cnMudGVtcGxhdGVVcmw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6ZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcblxyXG4gICAgLmRpcmVjdGl2ZSgnbmdjYXJ0U21hbGxDYXJ0JywgW2Z1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgOiAnQ2FydENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXR0cnMudGVtcGxhdGVVcmwgPT0gJ3VuZGVmaW5lZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd2aWV3cy9uZ0NhcnQvc21hbGwtY2FydC5odG1sJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnRlbXBsYXRlVXJsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG5cclxuICAgIC5kaXJlY3RpdmUoJ25nY2FydFNtYWxsQ2FydENvbGxhcHNlJywgW2Z1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgOiAnQ2FydENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgYXR0cnMudGVtcGxhdGVVcmwgPT0gJ3VuZGVmaW5lZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd2aWV3cy9uZ0NhcnQvc21hbGwtY2FydC1jb2xsYXBzZS5odG1sJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnRlbXBsYXRlVXJsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOmZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKVxyXG5cclxuICAgIC5kaXJlY3RpdmUoJ25nY2FydENoZWNrb3V0JywgW2Z1bmN0aW9uKCl7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3QgOiAnRScsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgOiAoJ0NhcnRDb250cm9sbGVyJywgWyckcm9vdFNjb3BlJywgJyRzY29wZScsICduZ0NhcnQnLCAnZnVsZmlsbWVudFByb3ZpZGVyJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCBuZ0NhcnQsIGZ1bGZpbG1lbnRQcm92aWRlcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5nQ2FydCA9IG5nQ2FydDtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hlY2tvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnVsZmlsbWVudFByb3ZpZGVyLnNldFNlcnZpY2UoJHNjb3BlLnNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1bGZpbG1lbnRQcm92aWRlci5zZXRTZXR0aW5ncygkc2NvcGUuc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1bGZpbG1lbnRQcm92aWRlci5jaGVja291dCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduZ0NhcnQ6Y2hlY2tvdXRfc3VjY2VlZGVkJywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmdDYXJ0OmNoZWNrb3V0X2ZhaWxlZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGRhdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfV0pLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZTonQCcsXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5nczonPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBhdHRycy50ZW1wbGF0ZVVybCA9PSAndW5kZWZpbmVkJyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3RlbXBsYXRlL25nQ2FydC9jaGVja291dC5odG1sJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnRlbXBsYXRlVXJsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuO1xyXG5hbmd1bGFyLm1vZHVsZSgnbmdDYXJ0LmZ1bGZpbG1lbnQnLCBbXSlcclxuICAgIC5zZXJ2aWNlKCdmdWxmaWxtZW50UHJvdmlkZXInLCBbJyRpbmplY3RvcicsIGZ1bmN0aW9uKCRpbmplY3Rvcil7XHJcblxyXG4gICAgICAgIHRoaXMuX29iaiA9IHtcclxuICAgICAgICAgICAgc2VydmljZSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgc2V0dGluZ3MgOiB1bmRlZmluZWRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnNldFNlcnZpY2UgPSBmdW5jdGlvbihzZXJ2aWNlKXtcclxuICAgICAgICAgICAgdGhpcy5fb2JqLnNlcnZpY2UgPSBzZXJ2aWNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuc2V0U2V0dGluZ3MgPSBmdW5jdGlvbihzZXR0aW5ncyl7XHJcbiAgICAgICAgICAgIHRoaXMuX29iai5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuY2hlY2tvdXQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgcHJvdmlkZXIgPSAkaW5qZWN0b3IuZ2V0KCduZ0NhcnQuZnVsZmlsbWVudC4nICsgdGhpcy5fb2JqLnNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgIHJldHVybiBwcm92aWRlci5jaGVja291dCh0aGlzLl9vYmouc2V0dGluZ3MpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfV0pXHJcblxyXG5cclxuLnNlcnZpY2UoJ25nQ2FydC5mdWxmaWxtZW50LmxvZycsIFsnJHEnLCAnJGxvZycsICduZ0NhcnQnLCBmdW5jdGlvbigkcSwgJGxvZywgbmdDYXJ0KXtcclxuXHJcbiAgICAgICAgdGhpcy5jaGVja291dCA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgJGxvZy5pbmZvKG5nQ2FydC50b09iamVjdCgpKTtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICBjYXJ0Om5nQ2FydC50b09iamVjdCgpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiB9XSlcclxuXHJcbi5zZXJ2aWNlKCduZ0NhcnQuZnVsZmlsbWVudC5odHRwJywgWyckaHR0cCcsICduZ0NhcnQnLCBmdW5jdGlvbigkaHR0cCwgbmdDYXJ0KXtcclxuXHJcbiAgICAgICAgdGhpcy5jaGVja291dCA9IGZ1bmN0aW9uKHNldHRpbmdzKXtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3Qoc2V0dGluZ3MudXJsLFxyXG4gICAgICAgICAgICAgICAgeyBkYXRhOiBuZ0NhcnQudG9PYmplY3QoKSwgb3B0aW9uczogc2V0dGluZ3Mub3B0aW9uc30pO1xyXG4gICAgICAgIH1cclxuIH1dKVxyXG5cclxuXHJcbi5zZXJ2aWNlKCduZ0NhcnQuZnVsZmlsbWVudC5wYXlwYWwnLCBbJyRodHRwJywgJ25nQ2FydCcsIGZ1bmN0aW9uKCRodHRwLCBuZ0NhcnQpe1xyXG5cclxuXHJcbn1dKTtcclxuIl19
